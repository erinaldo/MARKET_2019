USE [SEVEN]
GO
/****** Object:  StoredProcedure [dbo].[IAM_KARDEX]    Script Date: 07/02/2018 16:00:16 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[IAM_KARDEX] @COD VARCHAR(16),@FECHAINI VARCHAR(8),@FECHAFIN VARCHAR(8),@COD_ALMACEN BIGINTASDECLARE @CADENA VARCHAR(4500)SET @CADENA="SELECT  item, FECHA_KARDEX AS Fecha, Tipo_comp, ID_DOC AS ID, "+		" CASE WHEN TIPO_COMP='Compra' or tipo_comp='Venta' then DBO.BUSCAR_DOCUMENTO_KARDEX(ID_DOC, TIPO_COMP) else ID_DOC end  AS Doc, "+		" CONVERT(NUMERIC(18,2),pu) AS Precio, CASE WHEN TIPO_MOV = 'Ingreso' THEN CONVERT(NUMERIC(18,2),cant_kardex) ELSE 0.00 END AS Ingreso, "+                    "  CASE WHEN TIPO_MOV = 'Salida' THEN CONVERT(NUMERIC(18,2),cant_kardex) ELSE 0.00 END AS Salida, 0.00 AS Stock, convert(decimal(18,2),ROUND(COSTO_KARDEX,4)) AS Costo, 0 AS Total, Observaci AS Observacion "+		" FROM dbo.Kardex "+	" WHERE KARDEX.CODIGO='"+@COD+"' AND FECHA_KARDEX BETWEEN '"+@FECHAINI+"' AND '"+@FECHAFIN+"'"	IF @COD_ALMACEN<>0 SET @CADENA=@CADENA+" AND KARDEX.COD_ALMACEN="+CONVERT(VARCHAR,@COD_ALMACEN)+""SET @CADENA=@CADENA+" ORDER BY FECHA_KARDEX, tipo_mov,HORA_REG "PRINT @CADENAEXEC(@CADENA)
