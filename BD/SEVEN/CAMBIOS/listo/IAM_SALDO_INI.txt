SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[IAM_SALDO_INI]
@FI CHAR(8),@SALDO FLOAT OUTPUT
 AS

DECLARE @MONTO_I FLOAT
DECLARE @MONTO_S FLOAT

DECLARE @MONTO_IC FLOAT



SELECT @MONTO_I=SUM(CASE WHEN TIPO_MCAJA='I' THEN (CASE WHEN MON_MCAJA='S' THEN MONTO_MCAJA ELSE MONTO_MCAJA*TC_MCAJA END) ELSE 0 END),
@MONTO_S=SUM(CASE WHEN TIPO_MCAJA='S' THEN (CASE WHEN MON_MCAJA='S' THEN MONTO_MCAJA ELSE MONTO_MCAJA*TC_MCAJA END) ELSE 0 END)
FROM CAJA_OFICINA WHERE isnull(STAT_MCAJA,0)=0 AND FECHA_MCAJA<@FI

SELECT @MONTO_IC=SUM(MONTO_CAJA)
FROM MOVICAJA WHERE isnull(stat_caja,0)=0 and ISNULL(TRANSF_CAJA,0)=1 AND FECHA_CAJA<@FI

SET @SALDO=ISNULL(@MONTO_I,0)+ISNULL(@MONTO_IC,0)-ISNULL(@MONTO_S,0)

RETURN
