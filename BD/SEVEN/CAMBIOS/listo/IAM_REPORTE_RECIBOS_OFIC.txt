SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[IAM_REPORTE_RECIBOS_OFIC] 
@FI CHAR(8),@FF CHAR(8),@CAD VARCHAR(8000),@CAD2 VARCHAR(8000)
AS
DECLARE @CADENA VARCHAR(8000)

SET @CADENA="SELECT CASE WHEN STAT_MCAJA = 0 THEN '' ELSE 'Anulado' END AS Estado, TIPO_MCAJA AS Tipo, COD_MCAJA AS Codigo, FECHA_MCAJA AS Fecha,  "+
                     " MON_MCAJA AS Mon, CAJA_OFICINA.COD_PLANCTA AS Cuenta, CAJA_OFICINA.SUB_PLANCTA AS SubCuenta, ENTREGAMOS_MCAJA AS Entregamos, MONTO_MCAJA AS Monto, "+
                     " OBSERV_MCAJA AS Observ,'O' AS FORMA, dbo.PLAN_CUENTAS.DESC_PLANCTA, dbo.PLAN_CUENTASD.DESC_PLANCTAD "+
	" FROM CAJA_OFICINA INNER JOIN "+
                    " PLAN_CUENTAS ON dbo.CAJA_OFICINA.COD_PLANCTA = dbo.PLAN_CUENTAS.COD_PLANCTA INNER JOIN "+
                    " PLAN_CUENTASD ON dbo.CAJA_OFICINA.COD_PLANCTA = dbo.PLAN_CUENTASD.COD_PLANCTA AND "+
                    " CAJA_OFICINA.SUB_PLANCTA = dbo.PLAN_CUENTASD.SUB_PLANCTA "+
	" WHERE FECHA_MCAJA BETWEEN '"+@FI+"' AND '"+@FF+"' "
SET @CADENA=@CADENA+@CAD

SET @CADENA=@CADENA+ " UNION ALL "

SET @CADENA=@CADENA+" SELECT CASE WHEN ISNULL(STAT_CAJA,0) = 0 THEN '' ELSE 'Anulado' END AS Estado, TIPOMOVI AS Tipo, ID_CAJA AS Codigo, FECHA_CAJA AS Fecha, MON_CAJA AS Mon, '1000' AS Cuenta, '01' AS SubCuenta, "+
                    "  CONVERT(VARCHAR,TURNO) AS Entregamos, MONTO_CAJA AS Monto, OBSERV_CAJA AS Observ,'C' AS FORMA,'INGRESO A CAJA','VENTA MARKET' "+
	" FROM  dbo.MOVICAJA "+
	" WHERE (TRANSF_CAJA = 1) AND FECHA_CAJA BETWEEN '"+@FI+"' AND '"+@FF+"' "
SET @CADENA=@CADENA+@CAD2

SET @CADENA=@CADENA+ " ORDER BY FECHA "

print @CADENA
EXEC(@CADENA)
