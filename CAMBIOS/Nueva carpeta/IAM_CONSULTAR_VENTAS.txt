USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[IAM_CONSULTAR_VENTAS]    Script Date: 03/19/2018 09:41:42 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

ALTER PROCEDURE [dbo].[IAM_CONSULTAR_VENTAS] 
@FI CHAR(8),@FF CHAR(8),@TIPO CHAR(1),@CAD VARCHAR(MAX), @DOC VARCHAR(MAX)
AS
	DECLARE @CADENA VARCHAR(MAX)
	SET @CADENA="SELECT TIPO_DOC.DESC_DOC AS Origen, VENTACAB.COD_DOC as CodDoc, VENTACAB.NRODOCU as Nro, VENTACAB.FECHA_VENTA as Fecha, "+
	" VENTACAB.FECPROCESO AS FProceso,"+
	" CLIENTES.RUC_CLIENTE AS Ruc, CLIENTES.DESC_CLIENTE AS Cliente, "+
    " VENTACAB.DSCTO_VENTA as Dscto, VENTACAB.SUBTOT_VENTA as SubTotal, VENTACAB.IGV_VENTA as Igv, VENTACAB.TOTAL_VENTA as Total, "+
    " VENTACAB.FECHA_REG as FechaReg, "+
    " VENTACAB.COD_USER as Usuario, VENTACAB.NROPTOVTA as PtoVta,VENTACAB.TURNO as Turno, "+
    " CASE WHEN VENTACAB.STAT_VENTA=0 THEN '' ELSE 'ANULADO' END AS Estado, ISNULL(VENTACAB.FELECTRONICA,0) AS Felectronica "+
	" FROM VENTACAB INNER JOIN "+
    " TIPO_DOC ON VENTACAB.COD_DOC = TIPO_DOC.COD_DOC LEFT OUTER JOIN "+
    " CLIENTES ON VENTACAB.COD_CLIENTE = CLIENTES.COD_CLIENTE "
    IF @TIPO='D'
		BEGIN
			SET @CADENA=@CADENA+" WHERE (VENTACAB.FECHA_VENTA BETWEEN '"+@FI+"' AND '"+@FF+"')"
		END
	ELSE
		BEGIN
			SET @CADENA=@CADENA+" WHERE (VENTACAB.FECPROCESO BETWEEN '"+@FI+"' AND '"+@FF+"')"
		END
	SET @CADENA=@CADENA+" AND VENTACAB.COD_DOC IN("+@DOC+") "
	SET @CADENA=@CADENA+@CAD
	PRINT @CADENA
	EXEC(@CADENA)

