
/****** Object:  StoredProcedure [dbo].[IAM_LISTAR_EMITIDOS]    Script Date: 03/11/2018 16:06:13 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[IAM_LISTAR_EMITIDOS]
@FECPROCESO SMALLDATETIME,
@TURNO INT,
@COD_USER VARCHAR(10),
@TDOC CHAR(1)

AS

IF @TDOC='B'
	BEGIN
		SELECT VENTACAB.COD_DOC as CodDoc, TIPO_DOC.DESC_DOC as Tipo, VENTACAB.NRODOCU as Nro, VENTACAB.FECHA_VENTA as Fecha, 
		CLIENTES.DESC_CLIENTE as Cliente, VENTACAB.TOTAL_VENTA as Total, VENTACAB.FECHA_REG as FechaReg, 
        CASE WHEN STAT_VENTA = 0 THEN '' ELSE 'ANULADO' END AS Estado
		FROM VENTACAB INNER JOIN
        TIPO_DOC ON VENTACAB.COD_DOC = TIPO_DOC.COD_DOC LEFT OUTER JOIN
        CLIENTES ON VENTACAB.COD_CLIENTE = CLIENTES.COD_CLIENTE
		WHERE  (VENTACAB.COD_DOC = '002') AND (VENTACAB.FECPROCESO = @FECPROCESO) AND (VENTACAB.TURNO = @TURNO) 
		AND (VENTACAB.COD_USER = @COD_USER)
        ORDER BY VENTACAB.FECHA_REG DESC	
	END
IF @TDOC='F'
	BEGIN
		SELECT VENTACAB.COD_DOC as CodDoc, TIPO_DOC.DESC_DOC as Tipo, VENTACAB.NRODOCU as Nro, VENTACAB.FECHA_VENTA as Fecha, 
		CLIENTES.DESC_CLIENTE as Cliente, VENTACAB.TOTAL_VENTA as Total, VENTACAB.FECHA_REG as FechaReg, 
        CASE WHEN STAT_VENTA = 0 THEN '' ELSE 'ANULADO' END AS Estado
		FROM VENTACAB INNER JOIN
        TIPO_DOC ON VENTACAB.COD_DOC = TIPO_DOC.COD_DOC LEFT OUTER JOIN
        CLIENTES ON VENTACAB.COD_CLIENTE = CLIENTES.COD_CLIENTE
		WHERE  (VENTACAB.COD_DOC = '001') AND (VENTACAB.FECPROCESO = @FECPROCESO) AND (VENTACAB.TURNO = @TURNO) 
		AND (VENTACAB.COD_USER = @COD_USER)
        ORDER BY VENTACAB.FECHA_REG DESC	
	END
IF @TDOC='O' 
	BEGIN
		SELECT VENTACAB.COD_DOC AS CodDoc, TIPO_DOC.DESC_DOC AS Tipo, VENTACAB.NRODOCU AS Nro, VENTACAB.FECHA_VENTA AS Fecha, 
		CLIENTES.DESC_CLIENTE AS Cliente, 
        VENTACAB.TOTAL_VENTA AS Total, VENTACAB.FECHA_REG AS FechaReg, CASE WHEN STAT_VENTA = 0 THEN '' ELSE 'ANULADO' END AS Estado
		FROM VENTACAB INNER JOIN
        TIPO_DOC ON VENTACAB.COD_DOC = TIPO_DOC.COD_DOC INNER JOIN
        VENTACRED ON VENTACAB.COD_DOC = VENTACRED.COD_DOC AND VENTACAB.NRODOCU = VENTACRED.NRODOCU LEFT OUTER JOIN
        CLIENTES ON VENTACAB.COD_CLIENTE = CLIENTES.COD_CLIENTE
		WHERE  (VENTACAB.FECPROCESO = @FECPROCESO) AND (VENTACAB.TURNO = @TURNO) 
		AND (VENTACAB.COD_USER = @COD_USER)
        ORDER BY VENTACAB.FECHA_REG DESC	
	END

IF @TDOC='C'
	BEGIN
		SELECT ID_CAJA AS Nro,TIPOMOVI as Tipo,FECHA_CAJA as Fecha,OBSERV_CAJA as Observ,MONTO_CAJA as Importe,TRANSF_CAJA as Oficina
		FROM MOVICAJA
		WHERE COD_USER=@COD_USER AND FECHA_CAJA=@FECPROCESO AND TURNO=@TURNO
		ORDER BY FECHA_REG DESC
	END

IF @TDOC='T'
	BEGIN
		SELECT VENTACAB.COD_DOC AS CodDoc, TIPO_DOC.DESC_DOC AS Tipo, VENTACAB.NRODOCU AS Nro, VENTACAB.FECHA_VENTA AS Fecha, 
		CLIENTES.DESC_CLIENTE AS Cliente, 
        VENTACAB.TOTAL_VENTA AS Total, VENTACAB.FECHA_REG AS FechaReg, CASE WHEN STAT_VENTA = 0 THEN '' ELSE 'ANULADO' END AS Estado, 
        TARJETA.DESC_TARJETA AS Tarjeta, 
        VENTATARJ.MON_TARJETA as Mon, VENTATARJ.NRO_TARJETA as NroRef, VENTATARJ.MONTO_TARJETA As MontoTarj
		FROM VENTACAB INNER JOIN
        TIPO_DOC ON VENTACAB.COD_DOC = TIPO_DOC.COD_DOC INNER JOIN
        VENTATARJ ON VENTACAB.COD_DOC = VENTATARJ.COD_DOC AND VENTACAB.NRODOCU = VENTATARJ.NRODOCU INNER JOIN
        TARJETA ON VENTATARJ.COD_TARJETA = TARJETA.COD_TARJETA LEFT OUTER JOIN
        CLIENTES ON VENTACAB.COD_CLIENTE = CLIENTES.COD_CLIENTE
        WHERE  (VENTACAB.FECPROCESO = @FECPROCESO) AND (VENTACAB.TURNO = @TURNO) 
		AND (VENTACAB.COD_USER = @COD_USER)
        ORDER BY VENTACAB.FECHA_REG DESC	               
	END