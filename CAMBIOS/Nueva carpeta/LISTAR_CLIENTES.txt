USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[LISTAR_CLIENTES]    Script Date: 03/03/2018 23:07:55 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[LISTAR_CLIENTES]
	@SW INT,@CADENA VARCHAR(250),@CAMPO VARCHAR(250)
  AS
BEGIN
	DECLARE @CAD VARCHAR(2500)
	
	SET @CAD="SELECT COD_CLIENTE AS Codigo , DESC_CLIENTE AS Descripcion , RUC_CLIENTE as Ruc, case WHEN STAT_CLIENTE=1 THEN 'ANULADO' ELSE '' END AS Estado, "+
		"  dbo.CLIENTES.DIR_CLIENTE, dbo.CLIENTES.TELF_CLIENTE, dbo.CLIENTES.COD_FP, dbo.Forma_Pago.DESC_FP,ISNULL(LC_CLIENTE,0) AS LC_CLIENTE, "+
		" ISNULL(DNI_CLIENTE,'') AS DNI_CLIENTE,ISNULL(MAIL_CLIENTE,'') AS MAIL_CLIENTE "+
		" FROM  CLIENTES INNER JOIN "+
                      	" Forma_Pago ON dbo.CLIENTES.COD_FP = dbo.Forma_Pago.COD_FP " + 
		" WHERE STAT_CLIENTE<>3 "
	--TODOS
	PRINT @SW
	IF @SW<>2  SET @CAD=@CAD+"AND STAT_CLIENTE="+CONVERT(CHAR(1),@SW)+""

	--CAMPO A BUSCAR
	IF @CADENA<>'' SET @CAD=@CAD+" AND "+@CAMPO+" LIKE '%"+@CADENA+"%'" 

	
	SET @CAD=@CAD+" ORDER BY DESC_CLIENTE ASC"

	PRINT @CAD
	EXEC(@CAD)
END