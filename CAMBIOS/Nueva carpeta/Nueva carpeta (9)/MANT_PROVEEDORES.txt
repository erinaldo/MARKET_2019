USE [MARKET_CELESTE]
GO
/****** Object:  StoredProcedure [dbo].[MANT_PROVEEDORES]    Script Date: 11/28/2018 14:29:39 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROC [dbo].[MANT_PROVEEDORES]
(	@COD_PROVED	char(20),
	@DESC_PROVED	varchar(	150),
	@RUC_PROVED	char(11),
	@DIR_PROVED	varchar(150),
	@TELF_PROVED	char(10),
	@TELF2_PROVED	char(10),
	@CONTACTO_PROVED varchar(150),
	@PERCEP_PROVED FLOAT,
	 @TIP			CHAR(1), --N-NUEVO , M-MODIFICAR, A-ANULAR
	 @ingproc_001	 	int output
)
AS
BEGIN
	BEGIN TRAN	

	set @ingproc_001=0

	IF @TIP='N'
		BEGIN
			INSERT INTO PROVEEDORES(COD_PROVED,DESC_PROVED,	RUC_PROVED,DIR_PROVED,TELF_PROVED,TELF2_PROVED,
			CONTACTO_PROVED,STAT_PROVED,PERCEP_PROVED) VALUES(@COD_PROVED,@DESC_PROVED,@RUC_PROVED,@DIR_PROVED,
			@TELF_PROVED,@TELF2_PROVED,@CONTACTO_PROVED,0,@PERCEP_PROVED)
		END

	IF @TIP='M'
		BEGIN
			UPDATE PROVEEDORES SET 
			DESC_PROVED=@DESC_PROVED,
			RUC_PROVED=@RUC_PROVED,
			DIR_PROVED=@DIR_PROVED,
			TELF_PROVED=@TELF_PROVED,
			TELF2_PROVED=@TELF2_PROVED,
			CONTACTO_PROVED=@CONTACTO_PROVED,
			PERCEP_PROVED=@PERCEP_PROVED
			 WHERE COD_PROVED=@COD_PROVED
		END

	IF @TIP='A'
		BEGIN
			UPDATE PROVEEDORES SET STAT_PROVED=1 WHERE COD_PROVED=@COD_PROVED
		END

	IF (@@error!=0)
    	BEGIN
		set @ingproc_001=1
		RAISERROR 20000 'Error insertando Familia'
		ROLLBACK  TRAN
      		RETURN(1)
    	END

IR:
	COMMIT TRAN
	RETURN(0)
END