
/****** Object:  StoredProcedure [dbo].[IAM_RPT_LIQ_TURNO]    Script Date: 11/28/2018 10:40:39 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[IAM_RPT_LIQ_TURNO] 
@FI CHAR(8),@FF CHAR(8)

AS

SELECT     FECPROCESO as Proceso, COD_USER as Usuario, TURNO as Turno, SUM( TOTAL_VENTA) AS TotalVta,
(
SELECT  isnull( SUM(  VT.MONTO_TARJETA),0)
FROM         VENTATARJ VT INNER JOIN
                      VENTACAB VC ON VT.COD_DOC = VC.COD_DOC AND VT.NRODOCU = VC.NRODOCU
WHERE     (VC.STAT_VENTA = 0) AND VC.FECPROCESO=VENTACAB.FECPROCESO AND VC.COD_USER=VENTACAB.COD_USER
AND VC.TURNO=VENTACAB.TURNO

) AS Tarjeta,
(
SELECT  isnull( SUM(MONTO_CAJA),0)
FROM movicaja
WHERE     (ISNULL(STAT_CAJA,0) = 0) AND FECHA_CAJA=VENTACAB.FECPROCESO AND COD_USER=VENTACAB.COD_USER
AND TURNO=VENTACAB.TURNO AND TIPOMOVI='S'

) AS Depositos
FROM         VENTACAB
WHERE     (STAT_VENTA = 0) AND FECPROCESO BETWEEN @FI AND @FF
GROUP BY FECPROCESO, COD_USER, TURNO
ORDER BY FECPROCESO,TURNO

