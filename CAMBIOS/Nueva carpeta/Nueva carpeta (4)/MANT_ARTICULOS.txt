USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[MANT_ARTICULOS]    Script Date: 09/27/2018 14:27:27 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROC [dbo].[MANT_ARTICULOS]
( @COD_ART	char(15),
@DESC_ART	varchar(100),
@COD_MEDIDA	varchar(4),
@COD_FAMILIA	varchar(3),
@COD_GRUPO	varchar(3),
@COMBO_ART BIT,
@COD_SUNAT CHAR(8),
 @TIP			CHAR(1), --N-NUEVO , M-MODIFICAR, A-ANULAR
 @ingproc_001	 	int output
)
AS
BEGIN
	BEGIN TRAN	

	set @ingproc_001=0

	IF @TIP='N'
		BEGIN
			INSERT INTO ARTICULOS(COD_ART,DESC_ART,COD_MEDIDA,COD_FAMILIA,COD_GRUPO,COSTO_ART,STOCK_ART,STAT_ART,COMBO_ART,COD_SUNAT) VALUES
						(@COD_ART,@DESC_ART,@COD_MEDIDA,@COD_FAMILIA,@COD_GRUPO,0,0,0,@COMBO_ART,@COD_SUNAT  )
		END

	IF @TIP='M'
		BEGIN
			UPDATE ARTICULOS SET
				 DESC_ART=@DESC_ART,
				COD_MEDIDA=@COD_MEDIDA,
				COD_FAMILIA=@COD_FAMILIA,
				 COD_GRUPO=@COD_GRUPO,
				 COMBO_ART=@COMBO_ART ,
				 COD_SUNAT=@COD_SUNAT
				 WHERE COD_ART=@COD_ART
				 
			DELETE FROM COMBOS WHERE COD_ART=@COD_ART
		END

	IF @TIP='A'
		BEGIN
			UPDATE ARTICULOS SET STAT_ART=1 WHERE COD_ART=@COD_ART
		END

	IF (@@error!=0)
    	BEGIN
		set @ingproc_001=1
		RAISERROR 20000 'Error insertando Familia'
		ROLLBACK  TRAN
      		RETURN(1)
    	END

IR:
	COMMIT TRAN
	RETURN(0)
END