USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[PTOVTA_BUSCAR]    Script Date: 05/01/2018 13:59:43 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO


ALTER   PROCEDURE [dbo].[PTOVTA_BUSCAR]
(
	@intMODO TINYINT,
	@TERMINAL VARCHAR(20),
	@APTOSTAT BIT
)
AS
BEGIN 
 SET NOCOUNT ON 
 
    DECLARE @CADENA NVARCHAR(800)
    SET @CADENA = " SELECT     dbo.PTOVTA.APTOCODI, dbo.PTOVTA.APTOEDIT, dbo.PTOVTA.APTOFEPO, dbo.PTOVTA.APTOTERM, "+
                     " CASE WHEN PTOVTA.APTOSTAT = 1 THEN 'Inactivo' ELSE '' END AS Estado, dbo.PTOVTAD.APTOITEM, dbo.PTOVTAD.COD_DOC, "+
                     " dbo.PTOVTAD.APTONDOC, dbo.TIPO_DOC.DESC_DOC,APTOREG,dbo.PTOVTAD.APTOPORTIMP,ISNULL(PTOVTAD.NRO_PAPEL,0) AS Nro, "+
                     " ISNULL(PTOVTA.COD_ALMACEN,0) AS COD_ALMACEN,ISNULL(ALMACENES.DESC_ALMACEN,'') AS DESC_ALMACEN "+
		" FROM ALMACENES RIGHT OUTER JOIN "+
        " PTOVTA ON ALMACENES.COD_ALMACEN = PTOVTA.COD_ALMACEN LEFT OUTER JOIN "+
        " TIPO_DOC INNER JOIN PTOVTAD ON TIPO_DOC.COD_DOC = PTOVTAD.COD_DOC ON PTOVTA.APTOCODI = PTOVTAD.APTOCODI "

    IF  @intMODO =0 SET @CADENA =@CADENA + "WHERE PTOVTA.APTOCODI='"+@TERMINAL+"'"		
    --IF @intMODO = 1   AND @APTOSTAT=0  SET @CADENA =@CADENA + "WHERE APTOSTAT= 0"
	IF @INTMODO=1 SET @CADENA=@CADENA+ "WHERE PTOVTA.APTOTERM='"+@TERMINAL+"'"		
	
      PRINT @CADENA 
      EXEC (@CADENA)
END