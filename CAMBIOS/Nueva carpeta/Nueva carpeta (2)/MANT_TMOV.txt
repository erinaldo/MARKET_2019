USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[MANT_TMOV]    Script Date: 04/30/2018 12:16:28 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROC [dbo].[MANT_TMOV]
( @COD_TMOV  	CHAR(2),
  @DESC_TMOV 	VARCHAR(150),
  @INOUT_TMOV	BIT,
  @TRANSF_TMOV BIT,
  @TIP			CHAR(1), --N-NUEVO , M-MODIFICAR, A-ANULAR
 @ingproc_001	 	int output
)
AS
BEGIN
	BEGIN TRAN	

	set @ingproc_001=0

	IF @TIP='N'
		BEGIN
			INSERT INTO TIPOMOVI(COD_TMOV,DESC_TMOV,INOUT_TMOV,STAT_TMOV,TRANSF_TMOV) VALUES(@COD_TMOV,@DESC_TMOV,@INOUT_TMOV,0,@TRANSF_TMOV)
		END

	IF @TIP='M'
		BEGIN
			UPDATE TIPOMOVI SET DESC_TMOV=@DESC_TMOV,INOUT_TMOV=@INOUT_TMOV,TRANSF_TMOV=@TRANSF_TMOV WHERE COD_TMOV=@COD_TMOV
		END

	IF @TIP='A'
		BEGIN
			UPDATE TIPOMOVI SET STAT_TMOV=1 WHERE COD_TMOV=@COD_TMOV
		END

	IF (@@error!=0)
    	BEGIN
		set @ingproc_001=1
		RAISERROR 20000 'Error insertando Familia'
		ROLLBACK  TRAN
      		RETURN(1)
    	END

IR:
	COMMIT TRAN
	RETURN(0)
END