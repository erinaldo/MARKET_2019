USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[IAM_LISTAR_EMITIDOS]    Script Date: 05/01/2018 14:35:06 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO

alter PROCEDURE [dbo].[IAM_LISTAR_EMITIDOS_ARTICULOS]
@FECPROCESO SMALLDATETIME,
@TURNO INT,
@COD_USER VARCHAR(10)


AS


SELECT T.CODIGO as Codigo,T.ARTICULO as Descripcion,SUM(T.CANT) AS Cant,SUM(T.TOTAL) AS Total from 
(
SELECT     VENTADET.COD_ART AS Codigo, ARTICULOS.DESC_ART AS Articulo, VENTADET.CANTIDAD AS Cant, VENTADET.PRECIO AS Precio, VENTADET.DSCTO_PORC,
precio-precio*isnull(dscto_porc,0)/100 as PrecFin,cantidad*(precio-precio*isnull(dscto_porc,0)/100) as Total
FROM VENTACAB INNER JOIN
VENTADET ON VENTACAB.COD_DOC = VENTADET.COD_DOC AND VENTACAB.NRODOCU = VENTADET.NRODOCU INNER JOIN
ARTICULOS ON VENTADET.COD_ART = ARTICULOS.COD_ART
WHERE  (VENTACAB.stat_VENTA = 0) AND (VENTACAB.FECPROCESO = @FECPROCESO) AND (VENTACAB.TURNO = @TURNO) 
anD (VENTACAB.COD_USER = @COD_USER)
)t
group by t.codigo,t.articulo
ORDER BY t.codigo
