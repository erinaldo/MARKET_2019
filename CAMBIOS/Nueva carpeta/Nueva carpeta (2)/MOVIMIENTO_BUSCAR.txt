USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[MOVIMIENTO_BUSCAR]    Script Date: 04/30/2018 14:57:08 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[MOVIMIENTO_BUSCAR]
@COD_MOV VARCHAR(6),@TIPO_MOV CHAR(1)
 AS
SELECT     MOVIMIENTOS.COD_MOV, MOVIMIENTOS.TIPO_MOV, MOVIMIENTOS.COD_TMOV, TIPOMOVI.DESC_TMOV, MOVIMIENTOS.FECHA_MOV, MOVIMIENTOS.MON_MOV, 
                      MOVIMIENTOS.TC_MOV, MOVIMIENTOS.OBS_MOV, MOVIMIENTOS.TOTAL_MOV, MOVIMIENTOS_DETALLE.FILA_DM, MOVIMIENTOS_DETALLE.COD_ART, 
                      MOVIMIENTOS_DETALLE.CANT_DM, MOVIMIENTOS_DETALLE.PU_DM, ARTICULOS.DESC_ART, ARTICULOS.COD_MEDIDA, MEDIDA.DESC_MEDIDA,
                      MOVIMIENTOS.COD_ALMACEN, 
                      ALMACENES.DESC_ALMACEN, MOVIMIENTOS.ALM_DESTINO, ISNULL(ALM_DESTINO.DESC_ALMACEN, '') AS DESC_ALMACEN_D
FROM         ALMACENES INNER JOIN
                      MOVIMIENTOS INNER JOIN
                      MOVIMIENTOS_DETALLE ON MOVIMIENTOS.COD_MOV = MOVIMIENTOS_DETALLE.COD_MOV AND 
                      MOVIMIENTOS.TIPO_MOV = MOVIMIENTOS_DETALLE.TIPO_MOV INNER JOIN
                      TIPOMOVI ON MOVIMIENTOS.COD_TMOV = TIPOMOVI.COD_TMOV INNER JOIN
                      ARTICULOS ON MOVIMIENTOS_DETALLE.COD_ART = ARTICULOS.COD_ART INNER JOIN
                      MEDIDA ON ARTICULOS.COD_MEDIDA = MEDIDA.COD_MEDIDA ON ALMACENES.COD_ALMACEN = MOVIMIENTOS.COD_ALMACEN LEFT OUTER JOIN
                      ALMACENES AS ALM_DESTINO ON MOVIMIENTOS.ALM_DESTINO = ALM_DESTINO.COD_ALMACEN
WHERE     (MOVIMIENTOS.COD_MOV = @COD_MOV) AND (MOVIMIENTOS.TIPO_MOV = @TIPO_MOV)