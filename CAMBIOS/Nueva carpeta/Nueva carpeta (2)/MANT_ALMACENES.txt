USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[MANT_ALMACENES]    Script Date: 04/30/2018 12:01:59 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

ALTER PROC [dbo].[MANT_ALMACENES]
( @COD_ALMACEN  BIGINT,
  @DESC_ALMACEN 	VARCHAR(150),
  @STAT_ALMACEN BIT,
  @TIP			CHAR(1), --N-NUEVO , M-MODIFICAR, A-ANULAR
 @ingproc_001	 	int output
)
AS
BEGIN
	BEGIN TRAN	

	set @ingproc_001=0

	IF @TIP='N'
		BEGIN
			INSERT INTO ALMACENES(DESC_ALMACEN,STAT_ALMACEN) VALUES(@DESC_ALMACEN,@STAT_ALMACEN)
		END

	IF @TIP='M'
		BEGIN
			UPDATE ALMACENES SET DESC_ALMACEN=@DESC_ALMACEN,STAT_ALMACEN=@STAT_ALMACEN WHERE COD_ALMACEN=@COD_ALMACEN
		END

	IF @TIP='A'
		BEGIN
			UPDATE ALMACENES SET STAT_ALMACEN=1 WHERE COD_ALMACEN=@COD_ALMACEN
		END

	IF (@@error!=0)
    	BEGIN
		set @ingproc_001=1
		RAISERROR 20000 'Error insertando Familia'
		ROLLBACK  TRAN
      		RETURN(1)
    	END

IR:
	COMMIT TRAN
	RETURN(0)
END
