USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[LISTAR_ARTICULOS_VENTA]    Script Date: 05/01/2018 14:05:01 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[LISTAR_ARTICULOS_VENTA]
	@SW INT,@CADENA VARCHAR(250),@CAMPO VARCHAR(250),@APTOTERM NVARCHAR(30)
  AS
BEGIN
	DECLARE @CAD VARCHAR(2500)
	DECLARE @COD_ALMACEN BIGINT
	
	SELECT @COD_ALMACEN=COD_ALMACEN FROM PTOVTA WHERE APTOTERM=@APTOTERM AND APTOSTAT=0
	SET @COD_ALMACEN=ISNULL(@COD_ALMACEN,0)
	
	SET @CAD="SELECT ARTICULOS.COD_ART AS CODIGO, dbo.ARTICULOS.DESC_ART AS DESCRIPCION, "+
		--"ISNULL(dbo.ARTICULOS.STOCK_ART,0) AS STOCK,  "+
		" DBO.STOCK_TOTAL_ALMACEN(ARTICULOS.COD_ART,"+CONVERT(VARCHAR,@COD_ALMACEN)+") AS STOCK, "+
		" ART_PRECIO.PREBASE AS 'P.U.',ISNULL(COMBO_ART,0) AS COMBO "+
		" FROM         dbo.ARTICULOS INNER JOIN "+
                   "   dbo.ART_PRECIO ON dbo.ARTICULOS.COD_ART = dbo.ART_PRECIO.COD_ART "+
	"WHERE     (dbo.ARTICULOS.STAT_ART <> 3) AND (dbo.ART_PRECIO.COD_TPRECIO = '01') AND (ART_PRECIO.STAT_AP = 0) "
	--TODOS
	PRINT @SW
	IF @SW<>2  SET @CAD=@CAD+"AND STAT_ART="+CONVERT(CHAR(1),@SW)+""

	--CAMPO A BUSCAR
	IF @CADENA<>'' SET @CAD=@CAD+" AND "+@CAMPO+" LIKE '%"+@CADENA+"%'" 

	
	SET @CAD=@CAD+" ORDER BY DESC_ART ASC"

	PRINT @CAD
	EXEC(@CAD)
END