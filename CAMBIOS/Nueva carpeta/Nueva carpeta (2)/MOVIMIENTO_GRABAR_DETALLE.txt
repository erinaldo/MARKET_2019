USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[MOVIMIENTO_GRABAR_DETALLE]    Script Date: 04/30/2018 14:43:29 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[MOVIMIENTO_GRABAR_DETALLE] 
@COD_MOV	char(6),
@TIPO_MOV	char(1),
@FILA_DM	int,
@COD_ART	char(15),
@CANT_DM	float,
@PU_DM	float,
@FECHA_KARDEX DATETIME,
@MONEDA CHAR(1),
@COD_USER VARCHAR(10),
@TC FLOAT,
@COD_ALMACEN	bigint,
@ALM_DESTINO	bigint

AS
BEGIN
	DECLARE @COSTO AS FLOAT
	DECLARE @MOV AS VARCHAR(25)
	DECLARE @TMOV AS VARCHAR(25)

INSERT INTO MOVIMIENTOS_DETALLE(COD_MOV,TIPO_MOV,FILA_DM,COD_ART,	CANT_DM,PU_DM) VALUES (@COD_MOV,@TIPO_MOV,@FILA_DM,@cod_art,@cant_DM,@PU_DM)

SET @COSTO=@PU_DM

IF @TIPO_MOV='I' 
	BEGIN		
		 SET @MOV='Movimiento_I'
		 SET @TMOV='Ingreso'
	END
ELSE
	BEGIN
		SET @MOV='Movimiento_S'
		SET @TMOV='Salida'
	END

--AGREGAR AL KARDEX
EXEC AGREGAR_KARDEX @COD_ART,@CANT_DM,@FECHA_KARDEX,@MOV,@COD_MOV,@TMOV,'',@MONEDA,@COSTO,@COD_USER,@TC,@COD_ALMACEN

--TRANSFERENCIA
IF @ALM_DESTINO<>0
	BEGIN
		EXEC AGREGAR_KARDEX @COD_ART,@CANT_DM,@FECHA_KARDEX,'Movimiento_I',@COD_MOV,'Ingreso','',@MONEDA,@COSTO,@COD_USER,@TC,@ALM_DESTINO
		--EXEC AGREGAR_KARDEX 'I','M',@FECHA_MOV,'I',@COD_MOV,@COD_PROD_CUR,@CANT_CUR,
		--@ALM_DESTINO,@MON_MOV,@TC_MOV,@PU_KARDEX,@ID_CUR,''
	END








END