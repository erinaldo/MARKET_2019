USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[MANT_CLIENTES]    Script Date: 03/03/2018 23:01:34 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROC [dbo].[MANT_CLIENTES]
(	@COD_CLIENTE	char(20),
	@DESC_CLIENTE	varchar(	150),
	@RUC_CLIENTE	char(11),
	@DIR_CLIENTE	varchar(150),
	@TELF_CLIENTE	char(10),
	@COD_FP	char(3),
	@LC_CLIENTE FLOAT,
              @DNI_CLIENTE CHAR(8),
              @MAIL_CLIENTE VARCHAR(250),
	 @TIP			CHAR(1), --N-NUEVO , M-MODIFICAR, A-ANULAR
	 @ingproc_001	 	int output
)
AS
BEGIN
	BEGIN TRAN	

	set @ingproc_001=0

	IF @TIP='N'
		BEGIN
			INSERT INTO CLIENTES(COD_CLIENTE,DESC_CLIENTE,RUC_CLIENTE,DIR_CLIENTE,TELF_CLIENTE,COD_FP,LC_CLIENTE,DNI_CLIENTE,
			MAIL_CLIENTE,
			STAT_CLIENTE) VALUES(@COD_CLIENTE,@DESC_CLIENTE,@RUC_CLIENTE,@DIR_CLIENTE,
			@TELF_CLIENTE,@COD_FP,@LC_CLIENTE,@DNI_CLIENTE,@MAIL_CLIENTE,0)
		END

	IF @TIP='M'
		BEGIN
			UPDATE CLIENTES SET 
			DESC_CLIENTE=@DESC_CLIENTE,
			RUC_CLIENTE=@RUC_CLIENTE,
			DIR_CLIENTE=@DIR_CLIENTE,
			TELF_CLIENTE=@TELF_CLIENTE,
			COD_FP=@COD_FP,
			LC_CLIENTE=@LC_CLIENTE,
			DNI_CLIENTE=@DNI_CLIENTE,
			MAIL_CLIENTE=@MAIL_CLIENTE
			 WHERE COD_CLIENTE=@COD_CLIENTE
		END

	IF @TIP='A'
		BEGIN
			UPDATE CLIENTES SET STAT_CLIENTE=1 WHERE COD_CLIENTE=@COD_CLIENTE
		END

	IF (@@error!=0)
    	BEGIN
		set @ingproc_001=1
		RAISERROR 20000 'Error insertando Familia'
		ROLLBACK  TRAN
      		RETURN(1)
    	END

IR:
	COMMIT TRAN
	RETURN(0)
END