USE [MARKET]
GO
/****** Object:  StoredProcedure [dbo].[PTOVTA_BUSCAR]    Script Date: 03/16/2018 13:51:22 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO


ALTER   PROCEDURE [dbo].[PTOVTA_BUSCAR]
(
	@intMODO TINYINT,
	@TERMINAL VARCHAR(20),
	@APTOSTAT BIT
)
AS
BEGIN 
 SET NOCOUNT ON 
 
    DECLARE @CADENA NVARCHAR(800)
    SET @CADENA = " SELECT     dbo.PTOVTA.APTOCODI, dbo.PTOVTA.APTOEDIT, dbo.PTOVTA.APTOFEPO, dbo.PTOVTA.APTOTERM, "+
                     " CASE WHEN PTOVTA.APTOSTAT = 1 THEN 'Inactivo' ELSE '' END AS Estado, dbo.PTOVTAD.APTOITEM, dbo.PTOVTAD.COD_DOC, "+
                     " dbo.PTOVTAD.APTONDOC, dbo.TIPO_DOC.DESC_DOC,APTOREG,dbo.PTOVTAD.APTOPORTIMP,ISNULL(PTOVTAD.NRO_PAPEL,0) AS Nro "+
		" FROM  TIPO_DOC INNER JOIN "+
                     " PTOVTAD ON dbo.TIPO_DOC.COD_DOC = dbo.PTOVTAD.COD_DOC RIGHT OUTER JOIN "+
                     " PTOVTA ON dbo.PTOVTAD.APTOCODI = dbo.PTOVTA.APTOCODI "

    IF  @intMODO =0 SET @CADENA =@CADENA + "WHERE PTOVTA.APTOCODI='"+@TERMINAL+"'"		
    --IF @intMODO = 1   AND @APTOSTAT=0  SET @CADENA =@CADENA + "WHERE APTOSTAT= 0"
	IF @INTMODO=1 SET @CADENA=@CADENA+ "WHERE PTOVTA.APTOTERM='"+@TERMINAL+"'"		
	
      PRINT @CADENA 
      EXEC (@CADENA)
END