USE [MARKET_CELESTE]
GO
/****** Object:  StoredProcedure [dbo].[BUSCAR_TOT_GENERADO_COMITE_DETALLE]    Script Date: 11/04/2018 12:02:50 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



ALTER PROCEDURE [dbo].[BUSCAR_TOT_GENERADO_COMITE_DETALLE]
	@FI CHAR(8),@FF CHAR(8),@BRUTO FLOAT,
	@EMPRESA FLOAT OUTPUT,@EMPRESA1 FLOAT OUTPUT,
	@FINANCIERO FLOAT OUTPUT,@FINANCIERO1 FLOAT OUTPUT,
	@EXTRA FLOAT OUTPUT,@EXTRA1 FLOAT OUTPUT,
	@PERSONAL FLOAT OUTPUT,@PERSONAL1 FLOAT OUTPUT,
	@CAPITAL FLOAT OUTPUT,@CAPITAL1 FLOAT OUTPUT
  AS
BEGIN
	
	SELECT @EMPRESA=SUM(CAST(CASE WHEN ACTAMONE='S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2)))
	FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
    MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
    RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
	WHERE (DESC_RUBRO = 'Empresa') AND (A.GIRO_MOVB BETWEEN @FI AND @FF)
	SET @EMPRESA=ISNULL(@EMPRESA,0)
	
	SELECT @EMPRESA1=SUM(CAST(CASE WHEN ACTAMONE='S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2)))
	FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
    MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
    RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
	WHERE (DESC_RUBRO = 'Empresa') AND (A.GIRO_MOVB BETWEEN @FI AND @FF) AND (ISNULL(INCLUYE_DCOMITE,0) <> '1') 
	SET @EMPRESA=ISNULL(@EMPRESA,0)
	SET @EMPRESA1=@BRUTO-ISNULL(@EMPRESA1,0)
	
	SELECT @FINANCIERO=SUM(CAST(CASE WHEN ACTAMONE='S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2)))
	FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
    MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
    RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
	WHERE (DESC_RUBRO = 'Financiero') AND (A.GIRO_MOVB BETWEEN @FI AND @FF)
	SET @FINANCIERO=ISNULL(@FINANCIERO,0)
	
	SET @FINANCIERO1=@EMPRESA1-@FINANCIERO
	
	SELECT @EXTRA=SUM(CAST(CASE WHEN ACTAMONE='S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2)))
	FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
    MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
    RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
	WHERE (DESC_RUBRO = 'Extras') AND (A.GIRO_MOVB BETWEEN @FI AND @FF)
	SET @EXTRA=ISNULL(@EXTRA,0)
	
	SET @EXTRA1=@FINANCIERO1-@EXTRA
	
	SELECT @PERSONAL=SUM(CAST(CASE WHEN ACTAMONE='S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2)))
	FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
    MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
    RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
	WHERE (DESC_RUBRO = 'Personal') AND (A.GIRO_MOVB BETWEEN @FI AND @FF)
	SET @PERSONAL=ISNULL(@PERSONAL,0)
	
	SET @PERSONAL1=@EXTRA1-@PERSONAL
	
	
	SELECT @CAPITAL=SUM(CAST(CASE WHEN ACTAMONE='S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2)))
	FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
    MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
    RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
	WHERE (DESC_RUBRO = 'Capital') AND (A.GIRO_MOVB BETWEEN @FI AND @FF)
	SET @CAPITAL=ISNULL(@CAPITAL,0)
	
	SET @CAPITAL1=@PERSONAL1-@CAPITAL
	
	RETURN

END








