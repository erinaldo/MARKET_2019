USE [MARKET_CELESTE]
GO
/****** Object:  StoredProcedure [dbo].[CONSULTAR_COMITE_DETALLE]    Script Date: 11/04/2018 12:19:02 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO


ALTER PROCEDURE [dbo].[CONSULTAR_COMITE_DETALLE]
	@FI CHAR(8),@FF CHAR(8),@TIPO CHAR(1)
  AS
BEGIN
	IF @TIPO='D'
		BEGIN
			SELECT RUBROS.DESC_RUBRO AS Rubro, B.DESC_DCOMITE AS Descripcion, 
            SUM(CAST(CASE WHEN ACTAMONE = 'S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2))) AS 'Monto', 
            B.ESTIMADO_DCOMITE AS Estimado
			FROM         CTABANC INNER JOIN
                      MOVI_BANCO AS A INNER JOIN
                      DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO INNER JOIN
                      BANCOS ON CTABANC.COD_BANCO = BANCOS.COD_BANCO LEFT OUTER JOIN
                      RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
			WHERE (A.GIRO_MOVB BETWEEN @FI AND @FF) AND (A.TIPO_MOVB = 'S')
			GROUP BY B.DESC_DCOMITE, RUBROS.DESC_RUBRO, B.ESTIMADO_DCOMITE
			ORDER BY Descripcion
		END
	ELSE
		BEGIN
			SELECT RUBROS.DESC_RUBRO AS Descripcion, 
			SUM(CAST(CASE WHEN actamone = 'S' THEN A.MONTO_MOVB ELSE A.MONTO_MOVB * TC_MOVB END AS DECIMAL(18, 2))) AS 'Monto'
			FROM BANCOS INNER JOIN CTABANC ON BANCOS.COD_BANCO = CTABANC.COD_BANCO INNER JOIN
            MOVI_BANCO AS A INNER JOIN DETALLE_COMITE AS B ON A.COD_DCOMITE = B.COD_DCOMITE ON CTABANC.ACTACODI = A.COD_BANCO LEFT OUTER JOIN
            RUBROS ON B.COD_RUBRO = RUBROS.COD_RUBRO
			WHERE (A.GIRO_MOVB BETWEEN @FI AND @FF) AND (A.TIPO_MOVB = 'S')
			GROUP BY RUBROS.DESC_RUBRO
			ORDER BY 'DESCRIPCION'

		END
END


