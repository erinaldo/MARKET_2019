USE [MARKET_CELESTE]
GO

/****** Object:  StoredProcedure [dbo].[AGREGAR_KARDEX]    Script Date: 01/02/2019 15:05:25 ******/
SET ANSI_NULLS OFF
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[MANT_TEMP_INVENTARIO]
@COD_USER VARCHAR(10),
@cod_art	char(15),
@cant	float,
@COD_ALMACEN BIGINT,
@FECHA CHAR(8),
@TIPO CHAR(1),
@SW INT OUTPUT
AS

DECLARE @FIL AS INTEGER
SET @SW=0

IF @TIPO='N'
	BEGIN
		--AVERIGUAR SI ESTA INGRESADO
		IF (SELECT COUNT(COD_ART) FROM TEMP_INVENTARIO WHERE COD_USER=@COD_USER AND COD_ART=@COD_ART)>0
		BEGIN
			SET @SW=1
			RETURN
		END

		SELECT @FIL=ITEM FROM TEMP_INVENTARIO WHERE COD_USER=@COD_USER
		SET @FIL=ISNULL(@FIL,0)+1
		INSERT INTO TEMP_INVENTARIO(COD_USER,ITEM,COD_ART,COSTO_ART,CANT_ART,STOCK_ART)
		VALUES(@COD_USER,@FIL,@COD_ART,DBO.BUSCAR_COSTO_ANT(@COD_ART,@FECHA),@CANT,DBO.STOCK_INV(@COD_ART,@FECHA))
	END
IF @TIPO='M'
	BEGIN
		UPDATE TEMP_INVENTARIO SET CANT_ART=@CANT WHERE COD_USER=@COD_USER AND COD_ART=@COD_ART
	END

IF @TIPO='A'
	BEGIN
		DELETE TEMP_INVENTARIO WHERE COD_USER=@COD_USER AND COD_ART=@COD_ART
	END

GO


