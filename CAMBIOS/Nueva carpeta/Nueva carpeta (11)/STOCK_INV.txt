USE [MARKET_CELESTE]
GO
/****** Object:  UserDefinedFunction [dbo].[STOCK_ANT]    Script Date: 01/02/2019 17:11:03 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [dbo].[STOCK_INV] (@COD VARCHAR(16),@FEC VARCHAR(8)) 
RETURNS FLOAT
BEGIN 

	DECLARE @STOCK FLOAT


		SELECT @STOCK=SUM(CASE TIPO_MOV WHEN 'Ingreso' THEN cant_KARDEX ELSE 0 END)- SUM(CASE TIPO_MOV WHEN 'Salida' THEN cant_KARDEX ELSE 0 END) 
		FROM Kardex WHERE (codigo =@COD) AND (FECHA_KARDEX <= CONVERT(DATETIME, @FEC))

	SET @STOCK=ISNULL(@STOCK,0)

	RETURN @STOCK
END

