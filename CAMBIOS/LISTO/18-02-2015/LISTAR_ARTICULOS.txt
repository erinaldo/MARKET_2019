USE [MARKET_CALLAO]
GO
/****** Object:  StoredProcedure [dbo].[LISTAR_ARTICULOS]    Script Date: 02/18/2015 16:44:24 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER PROCEDURE [dbo].[LISTAR_ARTICULOS]
	@SW INT,@CADENA VARCHAR(250),@CAMPO VARCHAR(250)
  AS
BEGIN
	DECLARE @CAD VARCHAR(2500)
	
	SET @CAD="SELECT  ARTICULOS.COD_ART AS CODIGO, dbo.ARTICULOS.DESC_ART AS DESCRIPCION, "+
                    " CASE WHEN STAT_ART = 1 THEN 'ANULADO' ELSE '' END AS ESTADO, dbo.ARTICULOS.COD_MEDIDA, dbo.ARTICULOS.COD_FAMILIA,  "+
                    " ARTICULOS.COD_GRUPO, dbo.ARTICULOS.COSTO_ART, dbo.ARTICULOS.STOCK_ART, dbo.MEDIDA.DESC_MEDIDA, dbo.Familia.DESC_FAMILIA, "+
                    " Grupo.DESC_GRUPO,dbo.ART_BARRAS.COD_BARRAS,ISNULL(COMBO_ART,0) AS Combo  "+
	" FROM  ARTICULOS LEFT OUTER JOIN "+
                     " dbo.ART_BARRAS ON dbo.ARTICULOS.COD_ART = dbo.ART_BARRAS.COD_ART AND dbo.ART_BARRAS.STAT_BARRAS = 0 LEFT OUTER JOIN "+
                     " dbo.Familia ON dbo.ARTICULOS.COD_FAMILIA = dbo.Familia.COD_FAMILIA LEFT OUTER JOIN "+
                     " dbo.Grupo ON dbo.ARTICULOS.COD_GRUPO = dbo.Grupo.COD_GRUPO LEFT OUTER JOIN "+
                     " dbo.MEDIDA ON dbo.ARTICULOS.COD_MEDIDA = dbo.MEDIDA.COD_MEDIDA "+
		" WHERE (ARTICULOS.STAT_ART <> 3) "
	--TODOS
	PRINT @SW
	IF @SW<>2  SET @CAD=@CAD+"AND STAT_ART="+CONVERT(CHAR(1),@SW)+""

	--CAMPO A BUSCAR
	IF @CADENA<>'' SET @CAD=@CAD+" AND "+@CAMPO+" LIKE '%"+@CADENA+"%'" 

	
	SET @CAD=@CAD+" ORDER BY DESC_ART ASC"

	PRINT @CAD
	EXEC(@CAD)
END