
/****** Object:  StoredProcedure [dbo].[AGREGAR_TMP_COMPRAS_PU]    Script Date: 09/04/2019 16:59:56 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create PROCEDURE [dbo].[AGREGAR_TMP_COMPRAS_PU]
@CORR_TMP FLOAT,
@COD_ART CHAR(15),
@SW INT OUTPUT

 AS
 BEGIN TRAN	
	DECLARE @FILA BIGINT
	DECLARE @IGV FLOAT
	DECLARE @PU FLOAT

	--AVERIGUAMOS EL IGV
	--SELECT @IGV=ACFGPIGV FROM CONFIGSIS 
	--
	--AVERIGUAMOS LA FILA
	SELECT @FILA=MAX(ITEM) FROM TMP_DETALLE WHERE CORRNBR=@CORR_TMP
	SET @FILA=ISNULL(@FILA,0)+1
	
	SELECT @PU=PREBASE FROM ART_PRECIO WHERE COD_ART=@COD_ART AND STAT_AP=0
	SET @PU=ISNULL(@PU,0)
	
	SET @SW=0

	INSERT INTO TMP_DETALLE(CORRNBR,ITEM,COD_ART,ATMPCANT,ATMPPREC,ATMPIMPO)
	VALUES(@CORR_TMP,@FILA,@COD_ART,0,@PU,0)

	

	 IF (@@ERROR!=0)
	    BEGIN
		RAISERROR 2000 'error actualizando datos'
		ROLLBACK TRAN
		SET @SW=1
	        RETURN(1)

	    END
	
    COMMIT TRAN


