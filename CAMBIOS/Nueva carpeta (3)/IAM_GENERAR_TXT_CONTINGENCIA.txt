
/****** Object:  StoredProcedure [dbo].[IAM_GENERAR_TXT_CONTINGENCIA]    Script Date: 09/05/2019 15:44:17 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROCEDURE [dbo].[IAM_GENERAR_TXT_CONTINGENCIA]    
@ID_VENTASM BIGINT
  AS        
BEGIN      
SELECT     'S' AS Moneda, VENTAS_MANUAL.FECHA_VENTASM AS Fecha, VENTAS_MANUAL.SUBTOTAL_VENTASM AS AMO1BRUTO, VENTAS_MANUAL.IGV_VENTASM AS AMO1IGV, 
                      VENTAS_MANUAL.TOTAL_VENTASM AS AMO1TOFA, VENTAS_MANUAL.SERIE_VENTASM + '-' + RIGHT(VENTAS_MANUAL.NUMERO_VENTASM, 6) AS NRO_FACTURA, VENTAS_MANUAL.COD_DOC, 
                      ISNULL(CLIENTES.RUC_CLIENTE, '') AS ACLINRUC, ISNULL(CLIENTES.DESC_CLIENTE, '-') AS ACLIDESC, ISNULL(CLIENTES.DIR_CLIENTE, '') AS DIR_F, VENTAS_MANUAL.COD_CLIENTE AS AMO1CLIE, 
                      ISNULL(VENTAS_MANUAL.COD_USER, '') AS AMO1VEND, CASE WHEN ISNULL(CLIENTES.LC_CLIENTE, 0) = 0 THEN 'CONTADO' ELSE 'CREDITO' END AS AFPADESC, 
                      TIPO_DOC.DESC_DOC, VENTAS_MANUAL.PIGV AS VAL_IGV, 0 AS TC_VENTA, ISNULL(CLIENTES.MAIL_CLIENTE, '') AS EMAIL_CLIENTE, 
                      ISNULL(CLIENTES.DNI_CLIENTE, '-') AS DNI, ISNULL(CLIENTES.MAIL_CLIENTE, '-') AS MAIL, CONVERT(VARCHAR, VENTAS_MANUAL.FECHA_REG, 108) AS HoraVenta, CASE WHEN ISNULL(STAT_VENTASM, 0) 
                      = 0 THEN 0 ELSE 1 END AS ESTADO
FROM         VENTAS_MANUAL INNER JOIN
                      TIPO_DOC ON VENTAS_MANUAL.COD_DOC = TIPO_DOC.COD_DOC LEFT OUTER JOIN
                      CLIENTES ON VENTAS_MANUAL.COD_CLIENTE = CLIENTES.COD_CLIENTE
WHERE     (VENTAS_MANUAL.ID_VENTASM = @ID_VENTASM)
END 

