USE [SAN_DIEGO]
GO
/****** Object:  StoredProcedure [dbo].[IAM_GENERAR_TXT]    Script Date: 09/19/2019 15:57:01 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[IAM_GENERAR_TXT]    

@COD_DOC CHAR(3),@NRODOCU NUMERIC(10,0)

  AS        

BEGIN      
SELECT     VENTACAB.MON_VENTA AS Moneda, VENTACAB.FECHA_VENTA AS Fecha, VENTACAB.SUBTOT_VENTA AS AMO1BRUTO, VENTACAB.IGV_VENTA AS AMO1IGV, 
                      VENTACAB.TOTAL_VENTA AS AMO1TOFA, VENTACAB.NRODOCU, RIGHT('000' + LEFT(VENTACAB.NRODOCU, LEN(VENTACAB.NRODOCU) - 7), 3) + '-' + RIGHT(VENTACAB.NRODOCU, 7) 
                      AS NRO_FACTURA, VENTACAB.COD_DOC, ISNULL(CLIENTES.RUC_CLIENTE, '') AS ACLINRUC, ISNULL(CLIENTES.DESC_CLIENTE, '') AS ACLIDESC, ISNULL(CLIENTES.DIR_CLIENTE, '') AS DIR_F, 
                      ISNULL(VENTACAB.COD_CLIENTE, '') AS AMO1CLIE, ISNULL(VENTACAB.COD_USER, '') AS AMO1VEND, 'CONTADO' AS AFPADESC, '' AS AMO1TPLAC, TIPO_DOC.DESC_DOC, VENTACAB.VAL_IGV, 
                      VENTACAB.CAMBIO_VENTA AS TC_VENTA, ISNULL(CLIENTES.MAIL_CLIENTE, '') AS EMAIL_CLIENTE, ISNULL(CLIENTES.DNI_CLIENTE, '-') AS DNI, ISNULL(CLIENTES.MAIL_CLIENTE, '-') AS MAIL, 
                      CONVERT(VARCHAR, VENTACAB.FECHA_REG, 108) AS HoraVenta, CASE WHEN ISNULL(VENTACAB.STAT_VENTA, 0) = 0 THEN 0 ELSE 1 END AS ESTADO, ISNULL(VENTACAB.GRATUITA_VENTA, 0) 
                      AS GRATUITA_VENTA, ISNULL(VENTACAB.MONTO_GRATUITO_VENTA,0) AS MONTO_GRATUITO_VENTA
FROM         VENTACAB INNER JOIN
                      TIPO_DOC ON VENTACAB.COD_DOC = TIPO_DOC.COD_DOC LEFT OUTER JOIN
                      CLIENTES ON VENTACAB.COD_CLIENTE = CLIENTES.COD_CLIENTE
WHERE     (VENTACAB.COD_DOC = @COD_DOC) AND (VENTACAB.NRODOCU = @NRODOCU)
END 










